"use strict";var user_settings={},columns={proj:!0,rank:!0,ros:!0,depth:!0,spark:!0,avg:!0,med:!0,current:!0},update_freq={player:{time:30,typ:"m"}},experts={proj:{selection:["all"]},rank:{selection:["all"],num:{top:10,updated:1}},ros:{selection:["all"],num:{top:5,updated:7}}},misc={remove_ads:!0,fix_css:!0},changes={};changes.columns=$.extend(!0,{},columns),changes.update_freq=$.extend(!0,{},update_freq),changes.experts=$.extend(!0,{},experts),changes.misc=$.extend(!0,{},misc);var has_change=!1;function check_recursive(e,t){for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];if($.isPlainObject(a))check_recursive(a,t);else if("set"===t)e[r]=!1;else if("check"===t)if(!0===a)has_change=!0;else if("error"===a){has_change="error";break}}}function is_changed(){check_recursive(changes,"check");var e=has_change;return has_change=!1,e}check_recursive(changes,"set"),$(function(){var p=$("#save");function f(){var e=is_changed();"error"===e?(p.attr("disabled","disabled"),p.text("Save (fix errors)")):!0===e?(p.removeAttr("disabled"),p.text("Save")):(p.attr("disabled","disabled"),p.text("Save (no changes)"))}p.text("Loading...");var l=$("#columns input"),u=$('input[type="range"]'),h=$(".freq-typ"),d=$("#experts :input"),v=$("#misc input");$('input[type="text"][id$=top]').tooltip({placement:"bottom",trigger:"manual",template:'<div class="tooltip tooltip-error" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"Must be an integer greater than 1"}),$('input[type="text"][id$=updated]').tooltip({placement:"bottom",trigger:"manual",template:'<div class="tooltip tooltip-error" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"Must be a positive integer"}),chrome.storage.local.get("fp_user_settings",function(e){if(p.text("Save (no changes)"),(!(user_settings=e.fp_user_settings)||Object.keys(user_settings).length<=0)&&(user_settings={}),user_settings.hasOwnProperty("columns")){var t=user_settings.columns;$.each(t,function(e,t){columns[e]=t})}if(user_settings.hasOwnProperty("update_freq")){var r=user_settings.update_freq;$.each(r,function(e,t){update_freq[e]=t})}if(user_settings.hasOwnProperty("experts")){var a=user_settings.experts;$.each(a,function(e,t){experts[e]=t})}if(user_settings.hasOwnProperty("misc")){var n=user_settings.misc;$.each(n,function(e,t){misc[e]=t})}var s;$.each(columns,function(e,t){$("#show"+e).prop("checked",t)}),l.click(function(){var e=$(this),t=e.attr("id").replace("show",""),r=e.prop("checked");changes.columns[t]=columns[t]!==r,f()}),u.rangeslider({polyfill:!1,onInit:function(){s=$(".rangeslider__handle",this.$range);var e=this.$range.siblings("input:first").data("name"),t=(update_freq[e]||{}).time||this.value;s[0].textContent=t}}).on("input",function(){var e="time",t=parseInt(this.value);s[0].textContent=t;var r=$(this).data("name"),a=update_freq[r]||{};changes.update_freq[r][e]=a[e]!==t,f()}),u.each(function(){var e=$(this),t=e.data("name"),r=(update_freq[t]||{}).time||e.val();e.val(r).change()}),h.each(function(){var e=$(this),t=e.data("name"),r=update_freq[t]||{};e.val(r.typ)}),h.change(function(){var e=$(this),t=e.data("name"),r=e.val(),a=update_freq[t]||{};changes.update_freq[t].typ=a.typ!==r,f()}),$.each(experts,function(r,e){var t=e.selection;if(-1<t.indexOf("all"))$("#experts-"+r+"-selection-all").click();else for(var a=0;a<t.length;a++){var n=t[a].toLowerCase();$("#experts-"+r+"-selection-"+n).click()}if("rank"===r||"ros"===r){var s=e.num;$.each(s,function(e,t){$("#experts-"+r+"-num-"+e).val(t)})}}),d.change(function(){var t,e="experts",r=$(this),a=r.attr("id").split("-"),n=a[1],s=a[2],i=a[3],c=experts[n][s],o=!1,p=r.siblings(".tooltip-error");if("num"===s){t=r.val();var l=0;"top"===i&&(l=1),!(t=Number(t))||!Number.isInteger(t)||t<=l?(r.tooltip("show"),o="error"):p.length&&r.tooltip("hide")}else if("selection"===s){var u=r.parents(".row").find(":input[type=checkbox]"),h=u.filter(function(){return $(this).attr("id").match(/-all$/)});if("all"===i)u.not(r).each(function(){var e=$(this);!0===e.prop("checked")&&(e.parents(".btn").removeClass("active"),e.prop("checked",!1))}),!0!==r.prop("checked")&&(r.parents(".btn").addClass("active"),r.prop("checked",!0));else if(!0===h.prop("checked")&&(h.parents(".btn").removeClass("active"),h.prop("checked",!1)),"rank"===n||"ros"===n){var d=r.parents("#experts-"+n+"-top");if(1===d.length)d.find(":input[type=checkbox]").not(r).each(function(){var e=$(this);!0===e.prop("checked")&&(e.parents(".btn").removeClass("active"),e.prop("checked",!1))})}var v=u.filter(function(){return!0===$(this).prop("checked")});0===v.length&&(h.parents(".btn").addClass("active"),h.prop("checked",!0),v=h),t=[],v.each(function(){t.push($(this).attr("id").split("-").pop())})}Array.isArray(t)&&Array.isArray(c)?(o=!(c.length===t.length&&c.every(function(e){return t.includes(e)})),changes[e][n][s]=o):("error"!==o&&(o=c[i]!==t),changes[e][n][s][i]=o),f()}),$.each(misc,function(e,t){$("#"+e).prop("checked",t)}),v.click(function(){var e=$(this),t=e.attr("id"),r=e.prop("checked");changes.misc[t]=misc[t]!==r,f()});var i=$(".settings").outerHeight(!0),c=$(".contact").outerHeight(!0),o=$(".contact").outerHeight()-$(".contact").innerHeight();$(".changes").height(i-c-o)}),p.click(function(){p.text("Saving...");var e={fp_user_settings:{}},t=e.fp_user_settings,a={};$.each(columns,function(e,t){var r=$("#show"+e).prop("checked");a[e]=r}),t.columns=a;var n={};$.each(update_freq,function(e,t){var r=u.filter('[data-name="'+e+'"]'),a={time:parseInt(r.val()),typ:h.filter('[data-name="'+e+'"]').val()};n[e]=a}),t.update_freq=n;var c={};$.each(experts,function(e,t){var r={},a=$("#experts-"+e),n=a.find(":checked"),s=[];if(n.each(function(){var e=$(this).attr("id").split("-").pop();s.push(e)}),r.selection=s,"rank"===e||"ros"===e){var i={};a.find("input[type=text]").each(function(){var e=$(this).attr("id").split("-").pop(),t=Number($(this).val());i[e]=t}),r.num=i}c[e]=r}),t.experts=c;var s={};$.each(misc,function(e,t){var r=$("#"+e).prop("checked");s[e]=r}),t.misc=s,ga("send","event","Settings","Changed","prev: "+JSON.stringify(user_settings)+"; Current: "+JSON.stringify(t)),chrome.storage.local.set(e,function(){p.text("-> Saved Successfully! <-"),p.attr("disabled","disabled"),columns=a,update_freq=n,experts=c,misc=s,check_recursive(changes,"set")})})});